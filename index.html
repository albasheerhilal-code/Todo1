<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>قائمة مهام تزامنية</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3a0ca3;
            --accent: #4cc9f0;
            --success: #2ecc71;
            --danger: #e74c3c;
            --warning: #f39c12;
            --light: #f8f9fa;
            --dark: #2c3e50;
            --gray: #95a5a6;
            --border-radius: 12px;
            --shadow: 0 8px 30px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
            --online: #2ecc71;
            --offline: #e74c3c;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Cairo', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            min-height: 95vh;
        }

        /* Header */
        .header {
            background: linear-gradient(to left, var(--secondary), var(--primary));
            color: white;
            padding: 40px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="none"><path d="M0,0 L100,0 L100,100 Z" fill="rgba(255,255,255,0.1)"/></svg>');
            opacity: 0.1;
        }

        .header-content {
            position: relative;
            z-index: 1;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .header h1 {
            font-size: 2.8rem;
            margin-bottom: 15px;
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .header p {
            font-size: 1.4rem;
            opacity: 0.9;
            max-width: 800px;
        }

        /* Connection Status */
        .connection-status {
            display: flex;
            align-items: center;
            gap: 15px;
            background: rgba(255, 255, 255, 0.2);
            padding: 12px 25px;
            border-radius: 50px;
            backdrop-filter: blur(10px);
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--offline);
        }

        .status-indicator.connected {
            background: var(--online);
            box-shadow: 0 0 10px var(--online);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .status-text {
            font-weight: 600;
            font-size: 1.1rem;
        }

        /* Main Layout */
        .main-layout {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 30px;
            padding: 40px;
            flex: 1;
        }

        @media (max-width: 1200px) {
            .main-layout {
                grid-template-columns: 1fr 1fr;
            }
        }

        @media (max-width: 768px) {
            .main-layout {
                grid-template-columns: 1fr;
            }
            .header-content {
                flex-direction: column;
                gap: 20px;
            }
        }

        /* Cards */
        .card {
            background: var(--light);
            padding: 30px;
            border-radius: var(--border-radius);
            border: 1px solid #e8ecee;
            box-shadow: var(--shadow);
            transition: var(--transition);
            height: fit-content;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
        }

        .card-title {
            color: var(--dark);
            font-size: 1.8rem;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid var(--primary);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .card-title i {
            color: var(--primary);
            font-size: 1.6rem;
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 25px;
        }

        .form-label {
            display: block;
            margin-bottom: 10px;
            font-weight: 700;
            color: var(--dark);
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .input-with-button {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .input-with-button input {
            flex: 1;
        }

        input, textarea, select {
            width: 100%;
            padding: 16px;
            border: 2px solid #dfe6e9;
            border-radius: 10px;
            font-size: 1.1rem;
            transition: var(--transition);
            background: white;
        }

        input:focus, textarea:focus, select:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 4px rgba(67, 97, 238, 0.1);
        }

        textarea {
            min-height: 120px;
            resize: vertical;
            font-family: inherit;
        }

        /* Buttons */
        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 16px 28px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 700;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            min-width: 140px;
        }

        .btn:hover {
            background: var(--secondary);
            transform: translateY(-2px);
            box-shadow: 0 7px 20px rgba(67, 97, 238, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-success {
            background: var(--success);
        }

        .btn-success:hover {
            background: #27ae60;
            box-shadow: 0 7px 20px rgba(46, 204, 113, 0.3);
        }

        .btn-danger {
            background: var(--danger);
        }

        .btn-danger:hover {
            background: #c0392b;
            box-shadow: 0 7px 20px rgba(231, 76, 60, 0.3);
        }

        .btn-warning {
            background: var(--warning);
        }

        .btn-warning:hover {
            background: #e67e22;
            box-shadow: 0 7px 20px rgba(243, 156, 18, 0.3);
        }

        .btn-secondary {
            background: var(--gray);
        }

        .btn-secondary:hover {
            background: #7f8c8d;
            box-shadow: 0 7px 20px rgba(149, 165, 166, 0.3);
        }

        .btn-small {
            padding: 10px 18px;
            font-size: 1rem;
            min-width: auto;
        }

        .btn-icon {
            width: 40px;
            height: 40px;
            min-width: auto;
            padding: 0;
            border-radius: 50%;
        }

        /* Connection Management */
        .connection-section {
            background: linear-gradient(to left, #e8f4fc, #c5e3fc);
            padding: 25px;
            border-radius: var(--border-radius);
            border: 2px solid #90cdf4;
            margin-bottom: 25px;
        }

        .connection-controls {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }

        @media (max-width: 768px) {
            .connection-controls {
                grid-template-columns: 1fr;
            }
        }

        /* Online Users */
        .online-users {
            margin-top: 20px;
        }

        .online-users-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .online-users-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
            max-height: 300px;
            overflow-y: auto;
            padding: 10px;
        }

        .online-user-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px;
            background: white;
            border-radius: 10px;
            border: 2px solid #e8ecee;
            transition: var(--transition);
        }

        .online-user-item:hover {
            border-color: var(--primary);
            transform: translateX(-5px);
        }

        .online-user-info {
            display: flex;
            align-items: center;
            gap: 15px;
            flex: 1;
        }

        .online-user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.3rem;
            color: white;
            flex-shrink: 0;
            position: relative;
        }

        .online-user-avatar::after {
            content: '';
            position: absolute;
            bottom: 0;
            right: 0;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--offline);
            border: 2px solid white;
        }

        .online-user-avatar.online::after {
            background: var(--online);
        }

        .online-user-details {
            flex: 1;
        }

        .online-user-name {
            font-weight: 700;
            font-size: 1.2rem;
            color: var(--dark);
            margin-bottom: 5px;
        }

        .online-user-stats {
            font-size: 0.9rem;
            color: var(--gray);
            display: flex;
            gap: 15px;
        }

        .online-user-actions {
            display: flex;
            gap: 8px;
        }

        /* Tasks List */
        .tasks-container {
            max-height: 500px;
            overflow-y: auto;
            padding: 5px;
        }

        .tasks-container::-webkit-scrollbar {
            width: 8px;
        }

        .tasks-container::-webkit-scrollbar-track {
            background: #f1f2f6;
            border-radius: 10px;
        }

        .tasks-container::-webkit-scrollbar-thumb {
            background: #bdc3c7;
            border-radius: 10px;
        }

        .task-item {
            background: white;
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 10px;
            border-right: 5px solid var(--primary);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            transition: var(--transition);
            position: relative;
        }

        .task-item:hover {
            transform: translateX(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .task-item.completed {
            opacity: 0.8;
            border-right-color: var(--success);
            background: #f8fff9;
        }

        .task-item.completed .task-text {
            text-decoration: line-through;
            color: var(--gray);
        }

        .task-header {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            margin-bottom: 15px;
        }

        .task-checkbox {
            width: 22px;
            height: 22px;
            cursor: pointer;
            margin-top: 3px;
            flex-shrink: 0;
        }

        .task-text {
            font-size: 1.2rem;
            font-weight: 500;
            color: var(--dark);
            line-height: 1.5;
            flex: 1;
        }

        .task-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid #f1f2f6;
        }

        .task-user {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-tag {
            padding: 6px 15px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .task-date {
            color: var(--gray);
            font-size: 0.9rem;
            font-weight: 500;
        }

        .task-actions {
            display: flex;
            gap: 8px;
        }

        .task-editing {
            background: #fff9e6;
            border-color: var(--warning);
        }

        /* Chat Section */
        .chat-section {
            margin-top: 30px;
        }

        .chat-container {
            height: 300px;
            overflow-y: auto;
            padding: 15px;
            background: white;
            border-radius: 10px;
            border: 2px solid #dfe6e9;
            margin-bottom: 15px;
        }

        .chat-message {
            margin-bottom: 15px;
            padding: 12px 18px;
            border-radius: 15px;
            max-width: 80%;
            word-wrap: break-word;
        }

        .chat-message.sent {
            background: var(--primary);
            color: white;
            margin-left: auto;
            border-bottom-right-radius: 5px;
        }

        .chat-message.received {
            background: #f1f2f6;
            color: var(--dark);
            margin-right: auto;
            border-bottom-left-radius: 5px;
        }

        .chat-message-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 0.85rem;
            opacity: 0.8;
        }

        /* Empty States */
        .empty-state {
            text-align: center;
            padding: 50px 30px;
            color: var(--gray);
        }

        .empty-state i {
            font-size: 4rem;
            margin-bottom: 20px;
            color: #dfe6e9;
        }

        .empty-state h3 {
            font-size: 1.8rem;
            margin-bottom: 10px;
            color: var(--dark);
        }

        .empty-state p {
            font-size: 1.1rem;
            line-height: 1.6;
        }

        /* Statistics */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 25px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid #e8ecee;
            transition: var(--transition);
        }

        .stat-card:hover {
            border-color: var(--primary);
            transform: translateY(-3px);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 800;
            display: block;
            margin-bottom: 5px;
            color: var(--primary);
        }

        .stat-label {
            font-size: 1rem;
            color: var(--gray);
            font-weight: 600;
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 30px;
            color: var(--gray);
            border-top: 2px solid #e8ecee;
            background: #f8f9fa;
            margin-top: 40px;
        }

        .footer p {
            margin: 10px 0;
            line-height: 1.6;
        }

        /* Modals */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 30px 80px rgba(0, 0, 0, 0.3);
            transform: translateY(20px);
            animation: slideUp 0.4s ease forwards;
        }

        @keyframes slideUp {
            to { transform: translateY(0); }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .modal-header h3 {
            color: var(--dark);
            font-size: 1.8rem;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 2rem;
            color: var(--gray);
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .close-modal:hover {
            background: #fee;
            color: var(--danger);
        }

        .color-palette {
            display: flex;
            gap: 12px;
            margin-top: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .color-option {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid transparent;
            transition: var(--transition);
        }

        .color-option.selected {
            border-color: var(--dark);
            transform: scale(1.1);
            box-shadow: 0 0 0 3px rgba(44, 62, 80, 0.2);
        }

        /* Notifications */
        .notification {
            position: fixed;
            top: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            background: var(--success);
            color: white;
            padding: 20px 30px;
            border-radius: 10px;
            font-weight: 700;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            z-index: 1001;
            display: flex;
            align-items: center;
            gap: 15px;
            opacity: 0;
            transition: all 0.5s ease;
        }

        .notification.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        .notification.error {
            background: var(--danger);
        }

        .notification.warning {
            background: var(--warning);
        }

        .notification.info {
            background: var(--primary);
        }

        /* Typing Indicator */
        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 10px 15px;
            background: #f1f2f6;
            border-radius: 20px;
            width: fit-content;
            margin-bottom: 10px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--gray);
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typing {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        /* Activity Log */
        .activity-log {
            max-height: 200px;
            overflow-y: auto;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 10px;
            margin-top: 15px;
            font-size: 0.9rem;
        }

        .activity-item {
            padding: 8px 12px;
            border-bottom: 1px solid #e8ecee;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .activity-item:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-content">
                <div>
                    <h1><i class="fas fa-tasks"></i> قائمة مهام تزامنية</h1>
                    <p>قم بالاتصال بقائمة مهام وتعديلها مع الآخرين مباشرةً!</p>
                </div>
                <div class="connection-status">
                    <div class="status-indicator" id="status-indicator"></div>
                    <div class="status-text" id="status-text">غير متصل</div>
                </div>
            </div>
        </div>

        <!-- Main Layout -->
        <div class="main-layout">
            <!-- Left Column: Connection & Online Users -->
            <div class="card">
                <h2 class="card-title"><i class="fas fa-plug"></i> الاتصال</h2>
                
                <div class="connection-section">
                    <div class="form-group">
                        <label class="form-label"><i class="fas fa-user"></i> اسمك:</label>
                        <div class="input-with-button">
                            <input type="text" id="username-input" placeholder="اكتب اسمك...">
                            <button id="set-username-btn" class="btn btn-success">
                                <i class="fas fa-check"></i> تعيين
                            </button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label"><i class="fas fa-link"></i> ID الغرفة:</label>
                        <div class="connection-controls">
                            <input type="text" id="room-id-input" placeholder="أدخل ID الغرفة...">
                            <button id="join-room-btn" class="btn btn-success">
                                <i class="fas fa-sign-in-alt"></i> انضم
                            </button>
                        </div>
                        <div style="display: flex; gap: 10px; margin-top: 10px;">
                            <button id="create-room-btn" class="btn btn-small" style="flex: 1;">
                                <i class="fas fa-plus"></i> إنشاء غرفة
                            </button>
                            <button id="copy-room-id-btn" class="btn btn-small btn-secondary">
                                <i class="fas fa-copy"></i> نسخ ID
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Online Users -->
                <div class="online-users">
                    <div class="online-users-header">
                        <h3 class="card-title" style="font-size: 1.5rem; margin: 0;">
                            <i class="fas fa-users"></i> الأعضاء المتصلين
                        </h3>
                        <span class="user-count" id="user-count">(0)</span>
                    </div>
                    
                    <div class="online-users-list" id="online-users-list">
                        <div class="empty-state" style="padding: 20px;">
                            <i class="fas fa-users-slash"></i>
                            <p>لا يوجد أعضاء متصلين</p>
                        </div>
                    </div>
                </div>
                
                <!-- Chat -->
                <div class="chat-section">
                    <h3 class="card-title" style="font-size: 1.5rem; margin-bottom: 15px;">
                        <i class="fas fa-comments"></i> محادثة
                    </h3>
                    
                    <div class="chat-container" id="chat-container">
                        <!-- Chat messages will appear here -->
                        <div class="empty-state" style="padding: 20px;">
                            <i class="fas fa-comment-slash"></i>
                            <p>ابدأ المحادثة مع فريقك</p>
                        </div>
                    </div>
                    
                    <div class="input-with-button">
                        <input type="text" id="chat-input" placeholder="اكتب رسالة...">
                        <button id="send-chat-btn" class="btn btn-success">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Middle Column: Tasks -->
            <div class="card">
                <h2 class="card-title"><i class="fas fa-list-check"></i> المهام</h2>
                
                <!-- Task Input -->
                <div class="form-group">
                    <label class="form-label"><i class="fas fa-plus"></i> مهمة جديدة:</label>
                    <div class="input-with-button">
                        <input type="text" id="task-input" placeholder="اكتب مهمة جديدة...">
                        <button id="add-task-btn" class="btn btn-success">
                            <i class="fas fa-plus"></i> إضافة
                        </button>
                    </div>
                </div>
                
                <!-- Tasks List -->
                <div class="tasks-container" id="tasks-container">
                    <div class="empty-state">
                        <i class="fas fa-clipboard-list"></i>
                        <h3>لا توجد مهام</h3>
                        <p>ابدأ بإضافة أول مهمة</p>
                    </div>
                </div>
                
                <!-- Statistics -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <span class="stat-number" id="total-tasks">0</span>
                        <span class="stat-label">المهام</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number" id="completed-tasks">0</span>
                        <span class="stat-label">مكتملة</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number" id="active-users">0</span>
                        <span class="stat-label">نشيطون</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number" id="today-tasks">0</span>
                        <span class="stat-label">اليوم</span>
                    </div>
                </div>
            </div>
            
            <!-- Right Column: Actions & Info -->
            <div class="card">
                <h2 class="card-title"><i class="fas fa-cogs"></i> الإجراءات</h2>
                
                <!-- Quick Actions -->
                <div style="display: flex; flex-direction: column; gap: 15px; margin-bottom: 25px;">
                    <button id="mark-all-complete" class="btn btn-success">
                        <i class="fas fa-check-double"></i> إكمال الكل
                    </button>
                    <button id="clear-completed" class="btn btn-warning">
                        <i class="fas fa-broom"></i> تنظيف المكتملة
                    </button>
                    <button id="export-tasks" class="btn btn-secondary">
                        <i class="fas fa-download"></i> تصدير المهام
                    </button>
                </div>
                
                <!-- Room Info -->
                <div style="background: #f0f7ff; padding: 20px; border-radius: 10px; margin-bottom: 25px;">
                    <h3 class="card-title" style="font-size: 1.5rem; margin-bottom: 15px;">
                        <i class="fas fa-info-circle"></i> معلومات الغرفة
                    </h3>
                    <div style="margin-bottom: 10px;">
                        <strong>ID:</strong> <span id="current-room-id" style="font-family: monospace;">-</span>
                    </div>
                    <div style="margin-bottom: 10px;">
                        <strong>المنشئ:</strong> <span id="room-creator">-</span>
                    </div>
                    <div style="margin-bottom: 10px;">
                        <strong>تاريخ الإنشاء:</strong> <span id="room-created">-</span>
                    </div>
                </div>
                
                <!-- Activity Log -->
                <div>
                    <h3 class="card-title" style="font-size: 1.5rem; margin-bottom: 15px;">
                        <i class="fas fa-history"></i> النشاطات
                    </h3>
                    <div class="activity-log" id="activity-log">
                        <div class="activity-item">
                            <i class="fas fa-info-circle" style="color: var(--primary);"></i>
                            <span>مرحباً! أنشئ أو انضم لغرفة لتبدأ.</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <div class="footer">
            <p><strong>قائمة مهام تزامنية</strong> - تعاون مباشر في الوقت الحقيقي</p>
            <p>جميع التغييرات تظهر مباشرةً للمستخدمين المتصلين</p>
            <p>© 2024 - باستخدام WebSocket للاتصال المباشر</p>
        </div>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification">
        <i class="fas fa-check-circle"></i>
        <span id="notification-text">تمت العملية بنجاح!</span>
    </div>

    <script>
        // Application State
        const state = {
            username: null,
            userId: null,
            roomId: null,
            roomCreator: null,
            roomCreated: null,
            users: new Map(),
            tasks: [],
            chatMessages: [],
            activityLog: [],
            color: '#4361ee',
            isConnected: false,
            socket: null
        };

        // Color options
        const colorOptions = [
            '#4361ee', '#3a0ca3', '#4cc9f0', '#2ecc71',
            '#e74c3c', '#f39c12', '#9b59b6', '#1abc9c',
            '#d35400', '#34495e', '#e67e22', '#27ae60',
            '#8e44ad', '#16a085', '#c0392b', '#7f8c8d'
        ];

        // WebSocket server URL (Replace with your server URL)
        const WS_SERVER_URL = 'wss://socketsbay.com/wss/v2/1/demo/';
        // Note: For production, you need to set up your own WebSocket server
        // or use services like: Socket.io, Pusher, Firebase, or Supabase Realtime

        // DOM Elements
        const elements = {
            // Status
            statusIndicator: document.getElementById('status-indicator'),
            statusText: document.getElementById('status-text'),
            
            // Inputs
            usernameInput: document.getElementById('username-input'),
            roomIdInput: document.getElementById('room-id-input'),
            taskInput: document.getElementById('task-input'),
            chatInput: document.getElementById('chat-input'),
            
            // Buttons
            setUsernameBtn: document.getElementById('set-username-btn'),
            createRoomBtn: document.getElementById('create-room-btn'),
            joinRoomBtn: document.getElementById('join-room-btn'),
            copyRoomIdBtn: document.getElementById('copy-room-id-btn'),
            addTaskBtn: document.getElementById('add-task-btn'),
            sendChatBtn: document.getElementById('send-chat-btn'),
            markAllComplete: document.getElementById('mark-all-complete'),
            clearCompleted: document.getElementById('clear-completed'),
            exportTasks: document.getElementById('export-tasks'),
            
            // Containers
            onlineUsersList: document.getElementById('online-users-list'),
            userCount: document.getElementById('user-count'),
            tasksContainer: document.getElementById('tasks-container'),
            chatContainer: document.getElementById('chat-container'),
            activityLog: document.getElementById('activity-log'),
            
            // Info
            currentRoomId: document.getElementById('current-room-id'),
            roomCreator: document.getElementById('room-creator'),
            roomCreated: document.getElementById('room-created'),
            
            // Stats
            totalTasks: document.getElementById('total-tasks'),
            completedTasks: document.getElementById('completed-tasks'),
            activeUsers: document.getElementById('active-users'),
            todayTasks: document.getElementById('today-tasks'),
            
            // Notification
            notification: document.getElementById('notification'),
            notificationText: document.getElementById('notification-text')
        };

        // Initialize the app
        function init() {
            loadLocalData();
            setupEventListeners();
            generateUserId();
            updateUI();
            
            showNotification('مرحباً! ابدأ بكتابة اسمك ثم إنشاء أو الانضمام لغرفة.', 'info');
        }

        // Generate unique user ID
        function generateUserId() {
            state.userId = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        // Load local data
        function loadLocalData() {
            const savedUsername = localStorage.getItem('todoUsername');
            const savedColor = localStorage.getItem('todoColor');
            
            if (savedUsername) {
                state.username = savedUsername;
                elements.usernameInput.value = savedUsername;
            }
            
            if (savedColor) {
                state.color = savedColor;
            }
        }

        // Save local data
        function saveLocalData() {
            if (state.username) {
                localStorage.setItem('todoUsername', state.username);
            }
            localStorage.setItem('todoColor', state.color);
        }

        // WebSocket Connection Management
        function connectWebSocket() {
            try {
                // For demo purposes, we'll simulate WebSocket with polling
                // In production, replace with actual WebSocket connection
                
                state.socket = {
                    send: function(data) {
                        console.log('Sending:', data);
                        // Simulate receiving data
                        setTimeout(() => simulateIncomingData(data), 100);
                    },
                    close: function() {
                        state.isConnected = false;
                        updateConnectionStatus();
                    }
                };
                
                state.isConnected = true;
                updateConnectionStatus();
                showNotification('تم الاتصال بالخادم', 'success');
                
                // Join room if roomId exists
                if (state.roomId) {
                    joinRoom(state.roomId);
                }
                
            } catch (error) {
                console.error('Connection error:', error);
                showNotification('خطأ في الاتصال بالخادم', 'error');
            }
        }

        // Simulate WebSocket messages (Replace with actual WebSocket)
        function simulateIncomingData(data) {
            try {
                const message = typeof data === 'string' ? JSON.parse(data) : data;
                
                switch (message.type) {
                    case 'join':
                        handleUserJoin(message);
                        break;
                    case 'leave':
                        handleUserLeave(message);
                        break;
                    case 'task_add':
                        handleTaskAdd(message);
                        break;
                    case 'task_update':
                        handleTaskUpdate(message);
                        break;
                    case 'task_delete':
                        handleTaskDelete(message);
                        break;
                    case 'chat':
                        handleChatMessage(message);
                        break;
                    case 'room_info':
                        handleRoomInfo(message);
                        break;
                    case 'sync':
                        handleSyncData(message);
                        break;
                }
            } catch (error) {
                console.error('Error processing message:', error);
            }
        }

        // Send message via WebSocket
        function sendMessage(type, data) {
            if (!state.isConnected) {
                showNotification('غير متصل بالخادم', 'error');
                return;
            }
            
            const message = {
                type,
                userId: state.userId,
                username: state.username,
                roomId: state.roomId,
                timestamp: Date.now(),
                data
            };
            
            if (state.socket && state.socket.send) {
                state.socket.send(JSON.stringify(message));
            }
            
            // For demo, also process locally
            if (type !== 'join' && type !== 'leave') {
                setTimeout(() => simulateIncomingData(message), 50);
            }
        }

        // Message Handlers
        function handleUserJoin(message) {
            if (message.userId !== state.userId) {
                state.users.set(message.userId, {
                    id: message.userId,
                    username: message.username,
                    color: message.data?.color || '#4361ee',
                    joinedAt: message.timestamp,
                    isTyping: false
                });
                
                addActivity(`${message.username} انضم للغرفة`, 'join');
                updateOnlineUsers();
                showNotification(`${message.username} انضم للغرفة`, 'info');
            }
        }

        function handleUserLeave(message) {
            if (state.users.has(message.userId)) {
                const user = state.users.get(message.userId);
                addActivity(`${user.username} غادر الغرفة`, 'leave');
                state.users.delete(message.userId);
                updateOnlineUsers();
            }
        }

        function handleTaskAdd(message) {
            if (message.userId !== state.userId) {
                const task = message.data;
                state.tasks.push(task);
                renderTasks();
                updateStats();
                addActivity(`${message.username} أضاف مهمة جديدة`, 'task');
                showNotification(`${message.username} أضاف مهمة`, 'info');
            }
        }

        function handleTaskUpdate(message) {
            if (message.userId !== state.userId) {
                const taskId = message.data.taskId;
                const updates = message.data.updates;
                
                const taskIndex = state.tasks.findIndex(t => t.id === taskId);
                if (taskIndex !== -1) {
                    state.tasks[taskIndex] = { ...state.tasks[taskIndex], ...updates };
                    renderTasks();
                    updateStats();
                    
                    if (updates.completed) {
                        addActivity(`${message.username} أكمل مهمة`, 'complete');
                    }
                }
            }
        }

        function handleTaskDelete(message) {
            if (message.userId !== state.userId) {
                const taskId = message.data.taskId;
                state.tasks = state.tasks.filter(t => t.id !== taskId);
                renderTasks();
                updateStats();
                addActivity(`${message.username} حذف مهمة`, 'delete');
            }
        }

        function handleChatMessage(message) {
            if (message.userId !== state.userId) {
                state.chatMessages.push(message.data);
                renderChat();
                showNotification(`رسالة جديدة من ${message.username}`, 'info');
            }
        }

        function handleRoomInfo(message) {
            state.roomCreator = message.data.creator;
            state.roomCreated = message.data.created;
            updateRoomInfo();
        }

        function handleSyncData(message) {
            if (message.data.tasks) state.tasks = message.data.tasks;
            if (message.data.users) {
                state.users.clear();
                message.data.users.forEach(user => {
                    if (user.id !== state.userId) {
                        state.users.set(user.id, user);
                    }
                });
            }
            if (message.data.chatMessages) state.chatMessages = message.data.chatMessages;
            
            renderTasks();
            updateOnlineUsers();
            renderChat();
            updateStats();
            addActivity('تم مزامنة البيانات مع الخادم', 'sync');
        }

        // User Management
        function setUsername() {
            const username = elements.usernameInput.value.trim();
            
            if (!username) {
                showNotification('يرجى إدخال اسم المستخدم', 'error');
                return;
            }
            
            state.username = username;
            saveLocalData();
            updateUI();
            
            showNotification(`مرحباً ${username}!`, 'success');
            
            // If already in a room, notify others
            if (state.roomId && state.isConnected) {
                sendMessage('user_update', { username, color: state.color });
            }
        }

        // Room Management
        function createRoom() {
            if (!state.username) {
                showNotification('يرجى إدخال اسم المستخدم أولاً', 'error');
                elements.usernameInput.focus();
                return;
            }
            
            if (!state.isConnected) {
                connectWebSocket();
            }
            
            const roomId = 'room_' + Date.now() + '_' + Math.random().toString(36).substr(2, 6);
            joinRoom(roomId);
            
            state.roomCreator = state.username;
            state.roomCreated = new Date().toLocaleString('ar-EG');
            
            addActivity(`أنشأت الغرفة ${roomId}`, 'create');
            showNotification(`تم إنشاء الغرفة: ${roomId}`, 'success');
        }

        function joinRoom(roomId) {
            if (!roomId) {
                roomId = elements.roomIdInput.value.trim();
            }
            
            if (!roomId) {
                showNotification('يرجى إدخال ID الغرفة', 'error');
                return;
            }
            
            if (!state.username) {
                showNotification('يرجى إدخال اسم المستخدم أولاً', 'error');
                elements.usernameInput.focus();
                return;
            }
            
            if (!state.isConnected) {
                connectWebSocket();
            }
            
            state.roomId = roomId;
            elements.roomIdInput.value = roomId;
            
            // Clear previous data
            state.users.clear();
            state.tasks = [];
            state.chatMessages = [];
            
            // Send join message
            sendMessage('join', {
                color: state.color,
                roomId: state.roomId
            });
            
            // Request sync
            sendMessage('sync_request', { roomId });
            
            updateUI();
            addActivity(`انضممت للغرفة ${roomId}`, 'join');
            showNotification(`تم الانضمام للغرفة: ${roomId}`, 'success');
        }

        // Task Management
        function addTask() {
            if (!state.roomId) {
                showNotification('يرجى الانضمام أو إنشاء غرفة أولاً', 'error');
                return;
            }
            
            const taskText = elements.taskInput.value.trim();
            
            if (!taskText) {
                showNotification('يرجى إدخال نص المهمة', 'error');
                elements.taskInput.focus();
                return;
            }
            
            const task = {
                id: 'task_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                text: taskText,
                completed: false,
                userId: state.userId,
                username: state.username,
                userColor: state.color,
                createdAt: Date.now(),
                updatedAt: Date.now()
            };
            
            state.tasks.push(task);
            sendMessage('task_add', task);
            
            elements.taskInput.value = '';
            elements.taskInput.focus();
            
            renderTasks();
            updateStats();
            addActivity('أضفت مهمة جديدة', 'task');
        }

        function updateTask(taskId, updates) {
            const taskIndex = state.tasks.findIndex(t => t.id === taskId);
            if (taskIndex !== -1) {
                state.tasks[taskIndex] = { ...state.tasks[taskIndex], ...updates, updatedAt: Date.now() };
                renderTasks();
                updateStats();
                sendMessage('task_update', { taskId, updates });
            }
        }

        function deleteTask(taskId) {
            if (confirm('هل تريد حذف هذه المهمة؟')) {
                state.tasks = state.tasks.filter(t => t.id !== taskId);
                renderTasks();
                updateStats();
                sendMessage('task_delete', { taskId });
                addActivity('حذفت مهمة', 'delete');
            }
        }

        function markAllComplete() {
            if (state.tasks.length === 0) {
                showNotification('لا توجد مهام', 'warning');
                return;
            }
            
            const incompleteTasks = state.tasks.filter(t => !t.completed);
            
            if (incompleteTasks.length === 0) {
                showNotification('جميع المهام مكتملة بالفعل', 'warning');
                return;
            }
            
            if (confirm(`هل تريد إكمال جميع المهام (${incompleteTasks.length} مهمة)؟`)) {
                incompleteTasks.forEach(task => {
                    updateTask(task.id, { completed: true });
                });
                addActivity('أكملت جميع المهام', 'complete');
                showNotification(`تم إكمال ${incompleteTasks.length} مهمة`, 'success');
            }
        }

        function clearCompletedTasks() {
            const completedTasks = state.tasks.filter(t => t.completed);
            
            if (completedTasks.length === 0) {
                showNotification('لا توجد مهام مكتملة', 'warning');
                return;
            }
            
            if (confirm(`هل تريد حذف ${completedTasks.length} مهمة مكتملة؟`)) {
                completedTasks.forEach(task => {
                    deleteTask(task.id);
                });
                addActivity('حذفت جميع المهام المكتملة', 'delete');
                showNotification(`تم حذف ${completedTasks.length} مهمة مكتملة`, 'success');
            }
        }

        // Chat Functions
        function sendChatMessage() {
            if (!state.roomId) {
                showNotification('يرجى الانضمام أو إنشاء غرفة أولاً', 'error');
                return;
            }
            
            const text = elements.chatInput.value.trim();
            
            if (!text) {
                showNotification('يرجى إدخال نص الرسالة', 'error');
                elements.chatInput.focus();
                return;
            }
            
            const message = {
                id: 'msg_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                text,
                userId: state.userId,
                username: state.username,
                userColor: state.color,
                timestamp: Date.now()
            };
            
            state.chatMessages.push(message);
            sendMessage('chat', message);
            
            elements.chatInput.value = '';
            renderChat();
        }

        // UI Update Functions
        function updateUI() {
            updateConnectionStatus();
            updateOnlineUsers();
            updateRoomInfo();
            updateStats();
        }

        function updateConnectionStatus() {
            if (state.isConnected) {
                elements.statusIndicator.className = 'status-indicator connected';
                elements.statusText.textContent = `متصل ${state.roomId ? '| ' + state.roomId : ''}`;
            } else {
                elements.statusIndicator.className = 'status-indicator';
                elements.statusText.textContent = 'غير متصل';
            }
        }

        function updateOnlineUsers() {
            elements.onlineUsersList.innerHTML = '';
            elements.userCount.textContent = `(${state.users.size + 1})`;
            
            if (state.users.size === 0 && !state.username) {
                elements.onlineUsersList.innerHTML = `
                    <div class="empty-state" style="padding: 20px;">
                        <i class="fas fa-users-slash"></i>
                        <p>لا يوجد أعضاء متصلين</p>
                    </div>
                `;
                return;
            }
            
            // Add current user
            if (state.username) {
                const currentUserItem = document.createElement('div');
                currentUserItem.className = 'online-user-item';
                currentUserItem.innerHTML = `
                    <div class="online-user-info">
                        <div class="online-user-avatar online" style="background-color: ${state.color}">
                            ${state.username.charAt(0)}
                        </div>
                        <div class="online-user-details">
                            <div class="online-user-name">${state.username} <span style="color: var(--primary);">(أنت)</span></div>
                            <div class="online-user-stats">
                                <span>${state.tasks.filter(t => t.userId === state.userId).length} مهام</span>
                            </div>
                        </div>
                    </div>
                `;
                elements.onlineUsersList.appendChild(currentUserItem);
            }
            
            // Add other users
            state.users.forEach(user => {
                const userItem = document.createElement('div');
                userItem.className = 'online-user-item';
                userItem.innerHTML = `
                    <div class="online-user-info">
                        <div class="online-user-avatar online" style="background-color: ${user.color}">
                            ${user.username.charAt(0)}
                        </div>
                        <div class="online-user-details">
                            <div class="online-user-name">${user.username}</div>
                            <div class="online-user-stats">
                                <span>${state.tasks.filter(t => t.userId === user.id).length} مهام</span>
                                <span>${user.isTyping ? 'يكتب...' : ''}</span>
                            </div>
                        </div>
                    </div>
                `;
                elements.onlineUsersList.appendChild(userItem);
            });
        }

        function renderTasks() {
            elements.tasksContainer.innerHTML = '';
            
            if (state.tasks.length === 0) {
                elements.tasksContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-clipboard-list"></i>
                        <h3>لا توجد مهام</h3>
                        <p>ابدأ بإضافة أول مهمة</p>
                    </div>
                `;
                return;
            }
            
            // Sort tasks: incomplete first, then by date
            const sortedTasks = [...state.tasks].sort((a, b) => {
                if (a.completed !== b.completed) return a.completed ? 1 : -1;
                return b.createdAt - a.createdAt;
            });
            
            sortedTasks.forEach(task => {
                const taskItem = document.createElement('div');
                taskItem.className = `task-item ${task.completed ? 'completed' : ''}`;
                taskItem.innerHTML = `
                    <div class="task-header">
                        <input type="checkbox" class="task-checkbox" ${task.completed ? 'checked' : ''} data-id="${task.id}">
                        <div class="task-text">${task.text}</div>
                    </div>
                    <div class="task-footer">
                        <div class="task-user">
                            <div class="user-tag" style="background-color: ${task.userColor}; color: white;">
                                <i class="fas fa-user"></i>
                                ${task.username}
                            </div>
                        </div>
                        <div class="task-date">
                            ${formatDate(task.createdAt)}
                        </div>
                        <div class="task-actions">
                            <button class="btn btn-danger btn-icon delete-task" data-id="${task.id}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
                
                elements.tasksContainer.appendChild(taskItem);
            });
            
            // Add event listeners
            document.querySelectorAll('.task-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const taskId = this.dataset.id;
                    updateTask(taskId, { completed: this.checked });
                });
            });
            
            document.querySelectorAll('.delete-task').forEach(btn => {
                btn.addEventListener('click', function() {
                    const taskId = this.dataset.id;
                    deleteTask(taskId);
                });
            });
        }

        function renderChat() {
            elements.chatContainer.innerHTML = '';
            
            if (state.chatMessages.length === 0) {
                elements.chatContainer.innerHTML = `
                    <div class="empty-state" style="padding: 20px;">
                        <i class="fas fa-comment-slash"></i>
                        <p>ابدأ المحادثة مع فريقك</p>
                    </div>
                `;
                return;
            }
            
            state.chatMessages.forEach(msg => {
                const isCurrentUser = msg.userId === state.userId;
                const messageDiv = document.createElement('div');
                messageDiv.className = `chat-message ${isCurrentUser ? 'sent' : 'received'}`;
                messageDiv.style.backgroundColor = isCurrentUser ? state.color : msg.userColor + '20';
                messageDiv.innerHTML = `
                    <div class="chat-message-header">
                        <span>${msg.username}</span>
                        <span>${formatTime(msg.timestamp)}</span>
                    </div>
                    <div>${msg.text}</div>
                `;
                elements.chatContainer.appendChild(messageDiv);
            });
            
            // Scroll to bottom
            elements.chatContainer.scrollTop = elements.chatContainer.scrollHeight;
        }

        function updateRoomInfo() {
            elements.currentRoomId.textContent = state.roomId || '-';
            elements.roomCreator.textContent = state.roomCreator || '-';
            elements.roomCreated.textContent = state.roomCreated || '-';
        }

        function updateStats() {
            const total = state.tasks.length;
            const completed = state.tasks.filter(t => t.completed).length;
            const today = new Date().toDateString();
            const todayTasks = state.tasks.filter(t => 
                new Date(t.createdAt).toDateString() === today
            ).length;
            
            elements.totalTasks.textContent = total;
            elements.completedTasks.textContent = completed;
            elements.activeUsers.textContent = state.users.size + 1;
            elements.todayTasks.textContent = todayTasks;
        }

        function addActivity(text, type = 'info') {
            const activity = {
                text,
                type,
                timestamp: Date.now()
            };
            
            state.activityLog.unshift(activity);
            if (state.activityLog.length > 50) state.activityLog.pop();
            
            renderActivityLog();
        }

        function renderActivityLog() {
            elements.activityLog.innerHTML = '';
            
            state.activityLog.slice(0, 10).forEach(activity => {
                const icon = {
                    'join': 'fa-user-plus',
                    'leave': 'fa-user-minus',
                    'task': 'fa-tasks',
                    'complete': 'fa-check-circle',
                    'delete': 'fa-trash',
                    'create': 'fa-plus-circle',
                    'sync': 'fa-sync',
                    'info': 'fa-info-circle'
                }[activity.type] || 'fa-info-circle';
                
                const color = {
                    'join': 'var(--success)',
                    'leave': 'var(--danger)',
                    'task': 'var(--primary)',
                    'complete': 'var(--success)',
                    'delete': 'var(--danger)',
                    'create': 'var(--warning)',
                    'sync': 'var(--info)',
                    'info': 'var(--gray)'
                }[activity.type] || 'var(--gray)';
                
                const item = document.createElement('div');
                item.className = 'activity-item';
                item.innerHTML = `
                    <i class="fas ${icon}" style="color: ${color};"></i>
                    <span>${activity.text} - ${formatTime(activity.timestamp)}</span>
                `;
                elements.activityLog.appendChild(item);
            });
        }

        // Utility Functions
        function formatDate(timestamp) {
            const date = new Date(timestamp);
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);
            
            if (diffMins < 1) return 'الآن';
            if (diffMins < 60) return `قبل ${diffMins} دقيقة`;
            if (diffHours < 24) return `قبل ${diffHours} ساعة`;
            if (diffDays === 1) return 'أمس';
            if (diffDays < 7) return `قبل ${diffDays} يوم`;
            
            return date.toLocaleDateString('ar-EG');
        }

        function formatTime(timestamp) {
            return new Date(timestamp).toLocaleTimeString('ar-EG', {
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function showNotification(message, type = 'success') {
            elements.notificationText.textContent = message;
            elements.notification.className = 'notification';
            elements.notification.classList.add(type);
            elements.notification.classList.add('show');
            
            setTimeout(() => {
                elements.notification.classList.remove('show');
            }, 3000);
        }

        function copyRoomId() {
            if (!state.roomId) {
                showNotification('لا يوجد ID غرفة', 'error');
                return;
            }
            
            navigator.clipboard.writeText(state.roomId)
                .then(() => {
                    showNotification('تم نسخ ID الغرفة', 'success');
                })
                .catch(err => {
                    showNotification('فشل نسخ ID الغرفة', 'error');
                });
        }

        function exportTasksToJSON() {
            const dataToExport = {
                tasks: state.tasks,
                exportedAt: new Date().toISOString(),
                roomId: state.roomId,
                totalTasks: state.tasks.length,
                completedTasks: state.tasks.filter(t => t.completed).length
            };
            
            const dataStr = JSON.stringify(dataToExport, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
            const exportFileDefaultName = `مهام-${state.roomId || 'محلية'}-${new Date().toISOString().slice(0,10)}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showNotification('تم تصدير المهام', 'success');
        }

        // Event Listeners
        function setupEventListeners() {
            // Username
            elements.setUsernameBtn.addEventListener('click', setUsername);
            elements.usernameInput.addEventListener('keypress', e => {
                if (e.key === 'Enter') setUsername();
            });
            
            // Room Management
            elements.createRoomBtn.addEventListener('click', createRoom);
            elements.joinRoomBtn.addEventListener('click', () => joinRoom());
            elements.roomIdInput.addEventListener('keypress', e => {
                if (e.key === 'Enter') joinRoom();
            });
            elements.copyRoomIdBtn.addEventListener('click', copyRoomId);
            
            // Tasks
            elements.addTaskBtn.addEventListener('click', addTask);
            elements.taskInput.addEventListener('keypress', e => {
                if (e.key === 'Enter') addTask();
            });
            
            // Chat
            elements.sendChatBtn.addEventListener('click', sendChatMessage);
            elements.chatInput.addEventListener('keypress', e => {
                if (e.key === 'Enter') sendChatMessage();
            });
            
            // Actions
            elements.markAllComplete.addEventListener('click', markAllComplete);
            elements.clearCompleted.addEventListener('click', clearCompletedTasks);
            elements.exportTasks.addEventListener('click', exportTasksToJSON);
            
            // Auto-connect on page load (for demo)
            setTimeout(() => {
                if (!state.isConnected) {
                    connectWebSocket();
                }
            }, 1000);
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
