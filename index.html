<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>قائمة المهام المشتركة</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary-color: #4361ee;
            --secondary-color: #3a0ca3;
            --accent-color: #4cc9f0;
            --light-color: #f8f9fa;
            --dark-color: #212529;
            --success-color: #4caf50;
            --warning-color: #ff9800;
            --danger-color: #f44336;
            --border-radius: 10px;
            --box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        body {
            background-color: #f0f2f5;
            color: var(--dark-color);
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(to left, var(--primary-color), var(--secondary-color));
            color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .app-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        @media (max-width: 768px) {
            .app-container {
                grid-template-columns: 1fr;
            }
        }

        .panel {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--box-shadow);
        }

        .panel h2 {
            color: var(--secondary-color);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #eee;
            font-size: 1.8rem;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark-color);
        }

        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: border-color 0.3s;
            background-color: white;
        }

        input:focus, select:focus, textarea:focus {
            border-color: var(--primary-color);
            outline: none;
        }

        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: background-color 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        button:hover {
            background-color: var(--secondary-color);
        }

        button.secondary {
            background-color: #6c757d;
        }

        button.secondary:hover {
            background-color: #545b62;
        }

        button.success {
            background-color: var(--success-color);
        }

        button.success:hover {
            background-color: #3d8b40;
        }

        button.danger {
            background-color: var(--danger-color);
        }

        button.danger:hover {
            background-color: #d32f2f;
        }

        .buttons-row {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .todo-list {
            list-style: none;
            max-height: 400px;
            overflow-y: auto;
            padding: 5px;
        }

        .todo-item {
            display: flex;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            background-color: #f8f9fa;
            border-radius: var(--border-radius);
            border-left: 5px solid var(--primary-color);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .todo-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }

        .todo-item.completed {
            opacity: 0.7;
            border-left-color: var(--success-color);
        }

        .todo-item.completed .todo-text {
            text-decoration: line-through;
            color: #6c757d;
        }

        .todo-checkbox {
            margin-left: 15px;
            transform: scale(1.3);
            cursor: pointer;
        }

        .todo-content {
            flex: 1;
            margin-right: 15px;
        }

        .todo-text {
            font-weight: 500;
            margin-bottom: 5px;
        }

        .todo-meta {
            display: flex;
            font-size: 0.85rem;
            color: #6c757d;
            gap: 15px;
        }

        .todo-actions {
            display: flex;
            gap: 8px;
        }

        .todo-actions button {
            padding: 6px 10px;
            font-size: 0.8rem;
        }

        .person-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            background-color: #e0e0e0;
            margin-top: 5px;
        }

        .share-section {
            background-color: #e3f2fd;
            padding: 20px;
            border-radius: var(--border-radius);
            margin-top: 25px;
            text-align: center;
        }

        .share-link {
            display: flex;
            margin-top: 15px;
        }

        .share-link input {
            border-top-right-radius: 0;
            border-bottom-right-radius: 0;
            border-right: none;
        }

        .share-link button {
            border-top-left-radius: 0;
            border-bottom-left-radius: 0;
            white-space: nowrap;
        }

        .stats {
            display: flex;
            justify-content: space-around;
            text-align: center;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }

        .stat-item h3 {
            color: var(--primary-color);
            font-size: 2rem;
            margin-bottom: 5px;
        }

        .language-switch {
            position: absolute;
            top: 20px;
            left: 20px;
        }

        .language-switch button {
            background-color: white;
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
            padding: 8px 15px;
        }

        .language-switch button:hover {
            background-color: var(--primary-color);
            color: white;
        }

        .empty-list {
            text-align: center;
            padding: 40px 20px;
            color: #6c757d;
            font-size: 1.1rem;
        }

        .empty-list i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: #bdbdbd;
        }

        footer {
            text-align: center;
            margin-top: 30px;
            color: #6c757d;
            font-size: 0.9rem;
            padding-top: 20px;
            border-top: 1px solid #ddd;
        }

        .user-color {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-left: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-tasks"></i> قائمة المهام المشتركة</h1>
            <p class="subtitle">أنشئ قائمة مهام يمكن مشاركتها مع عدة أشخاص باللغة العربية</p>
        </header>

        <div class="app-container">
            <div class="panel">
                <h2><i class="fas fa-user-plus"></i> إضافة مهمة جديدة</h2>
                <div class="form-group">
                    <label for="taskText">نص المهمة</label>
                    <textarea id="taskText" rows="3" placeholder="أدخل وصف المهمة هنا..."></textarea>
                </div>
                
                <div class="form-group">
                    <label for="personName">اسم الشخص</label>
                    <select id="personName">
                        <option value="أحمد">أحمد</option>
                        <option value="سارة">سارة</option>
                        <option value="محمد">محمد</option>
                        <option value="فاطمة">فاطمة</option>
                        <option value="خالد">خالد</option>
                        <option value="نورة">نورة</option>
                    </select>
                </div>

                <div class="buttons-row">
                    <button id="addTaskBtn" class="success">
                        <i class="fas fa-plus"></i> إضافة مهمة
                    </button>
                    <button id="clearCompletedBtn" class="secondary">
                        <i class="fas fa-check-double"></i> حذف المهام المكتملة
                    </button>
                </div>

                <div class="share-section">
                    <h3><i class="fas fa-share-alt"></i> مشاركة القائمة</h3>
                    <p>انسخ الرابط أدناه لمشاركة هذه القائمة مع الآخرين:</p>
                    <div class="share-link">
                        <input type="text" id="shareUrl" readonly>
                        <button id="copyUrlBtn">
                            <i class="fas fa-copy"></i> نسخ
                        </button>
                    </div>
                </div>
            </div>

            <div class="panel">
                <h2><i class="fas fa-list-check"></i> قائمة المهام (<span id="tasksCount">0</span>)</h2>
                <ul id="todoList" class="todo-list">
                    <!-- Tasks will be added here dynamically -->
                    <li class="empty-list">
                        <i class="fas fa-clipboard-list"></i>
                        <p>لا توجد مهام حالياً. أضف مهمة جديدة!</p>
                    </li>
                </ul>

                <div class="stats">
                    <div class="stat-item">
                        <h3 id="totalTasks">0</h3>
                        <p>إجمالي المهام</p>
                    </div>
                    <div class="stat-item">
                        <h3 id="completedTasks">0</h3>
                        <p>مكتملة</p>
                    </div>
                    <div class="stat-item">
                        <h3 id="pendingTasks">0</h3>
                        <p>قيد التنفيذ</p>
                    </div>
                </div>
            </div>
        </div>

        <footer>
            <p>تم التطوير باستخدام HTML و JavaScript - يدعم اللغة العربية والمشاركة بين عدة أشخاص</p>
            <p>يتم حفظ البيانات محلياً في المتصفح</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // DOM elements
            const taskText = document.getElementById('taskText');
            const personName = document.getElementById('personName');
            const addTaskBtn = document.getElementById('addTaskBtn');
            const clearCompletedBtn = document.getElementById('clearCompletedBtn');
            const todoList = document.getElementById('todoList');
            const shareUrl = document.getElementById('shareUrl');
            const copyUrlBtn = document.getElementById('copyUrlBtn');
            const tasksCount = document.getElementById('tasksCount');
            const totalTasks = document.getElementById('totalTasks');
            const completedTasks = document.getElementById('completedTasks');
            const pendingTasks = document.getElementById('pendingTasks');
            
            // Generate unique ID for this list
            let listId = localStorage.getItem('sharedTodoListId');
            if (!listId) {
                listId = 'list_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('sharedTodoListId', listId);
            }
            
            // Set up sharing URL
            const currentUrl = window.location.href.split('?')[0];
            const shareableUrl = currentUrl + '?list=' + listId;
            shareUrl.value = shareableUrl;
            
            // Person colors for visual identification
            const personColors = {
                'أحمد': '#4361ee',
                'سارة': '#f72585',
                'محمد': '#4cc9f0',
                'فاطمة': '#7209b7',
                'خالد': '#2ec4b6',
                'نورة': '#ff9e00'
            };
            
            // Load tasks from localStorage
            let tasks = JSON.parse(localStorage.getItem(listId)) || [];
            
            // Initialize the app
            function init() {
                renderTasks();
                updateStats();
                
                // Check if we're loading a shared list
                const urlParams = new URLSearchParams(window.location.search);
                const sharedListId = urlParams.get('list');
                
                if (sharedListId && sharedListId !== listId) {
                    // Load shared list
                    const sharedTasks = JSON.parse(localStorage.getItem(sharedListId));
                    if (sharedTasks && sharedTasks.length > 0) {
                        if (confirm('هل تريد تحميل قائمة المهام المشتركة؟ سيتم استبدال قائمتك الحالية.')) {
                            tasks = sharedTasks;
                            listId = sharedListId;
                            localStorage.setItem('sharedTodoListId', listId);
                            shareUrl.value = currentUrl + '?list=' + listId;
                            saveTasks();
                            renderTasks();
                            updateStats();
                        }
                    }
                }
            }
            
            // Save tasks to localStorage
            function saveTasks() {
                localStorage.setItem(listId, JSON.stringify(tasks));
            }
            
            // Render tasks to the DOM
            function renderTasks() {
                if (tasks.length === 0) {
                    todoList.innerHTML = `
                        <li class="empty-list">
                            <i class="fas fa-clipboard-list"></i>
                            <p>لا توجد مهام حالياً. أضف مهمة جديدة!</p>
                        </li>
                    `;
                    tasksCount.textContent = '0';
                    return;
                }
                
                todoList.innerHTML = '';
                tasksCount.textContent = tasks.length;
                
                tasks.forEach((task, index) => {
                    const taskItem = document.createElement('li');
                    taskItem.className = `todo-item ${task.completed ? 'completed' : ''}`;
                    
                    taskItem.innerHTML = `
                        <input type="checkbox" class="todo-checkbox" ${task.completed ? 'checked' : ''} data-index="${index}">
                        <div class="todo-content">
                            <div class="todo-text">${task.text}</div>
                            <div class="todo-meta">
                                <span>بواسطة: ${task.person}</span>
                                <span>${formatDate(task.createdAt)}</span>
                            </div>
                            <div class="person-badge" style="background-color: ${personColors[task.person] || '#e0e0e0'}; color: ${getContrastColor(personColors[task.person] || '#e0e0e0')}">
                                ${task.person}
                                <span class="user-color" style="background-color: ${personColors[task.person] || '#e0e0e0'}"></span>
                            </div>
                        </div>
                        <div class="todo-actions">
                            <button class="${task.completed ? 'secondary' : 'success'}" data-index="${index}" data-action="toggle">
                                <i class="fas ${task.completed ? 'fa-undo' : 'fa-check'}"></i>
                            </button>
                            <button class="danger" data-index="${index}" data-action="delete">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    `;
                    
                    todoList.appendChild(taskItem);
                });
                
                // Add event listeners to checkboxes and buttons
                document.querySelectorAll('.todo-checkbox').forEach(checkbox => {
                    checkbox.addEventListener('change', function() {
                        toggleTask(this.dataset.index);
                    });
                });
                
                document.querySelectorAll('.todo-actions button').forEach(button => {
                    button.addEventListener('click', function() {
                        const index = this.dataset.index;
                        const action = this.dataset.action;
                        
                        if (action === 'toggle') {
                            toggleTask(index);
                        } else if (action === 'delete') {
                            deleteTask(index);
                        }
                    });
                });
            }
            
            // Format date for display
            function formatDate(timestamp) {
                const date = new Date(timestamp);
                const now = new Date();
                const diffTime = Math.abs(now - date);
                const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
                
                if (diffDays === 0) {
                    return 'اليوم';
                } else if (diffDays === 1) {
                    return 'أمس';
                } else if (diffDays < 7) {
                    return `قبل ${diffDays} أيام`;
                } else {
                    return date.toLocaleDateString('ar-EG');
                }
            }
            
            // Get contrast color for text based on background
            function getContrastColor(hexColor) {
                // Convert hex to RGB
                const r = parseInt(hexColor.substr(1, 2), 16);
                const g = parseInt(hexColor.substr(3, 2), 16);
                const b = parseInt(hexColor.substr(5, 2), 16);
                
                // Calculate luminance
                const luminance = (0.299 * r + 0.587 * g + 0.114 * b) / 255;
                
                // Return black or white based on luminance
                return luminance > 0.5 ? '#000000' : '#FFFFFF';
            }
            
            // Update statistics
            function updateStats() {
                const total = tasks.length;
                const completed = tasks.filter(task => task.completed).length;
                const pending = total - completed;
                
                totalTasks.textContent = total;
                completedTasks.textContent = completed;
                pendingTasks.textContent = pending;
            }
            
            // Add a new task
            function addTask() {
                const text = taskText.value.trim();
                const person = personName.value;
                
                if (text === '') {
                    alert('يرجى إدخال نص المهمة!');
                    taskText.focus();
                    return;
                }
                
                const newTask = {
                    text,
                    person,
                    completed: false,
                    createdAt: new Date().getTime(),
                    id: Date.now() + Math.random().toString(36).substr(2, 9)
                };
                
                tasks.unshift(newTask);
                saveTasks();
                renderTasks();
                updateStats();
                
                // Clear input
                taskText.value = '';
                taskText.focus();
            }
            
            // Toggle task completion status
            function toggleTask(index) {
                tasks[index].completed = !tasks[index].completed;
                saveTasks();
                renderTasks();
                updateStats();
            }
            
            // Delete a task
            function deleteTask(index) {
                if (confirm('هل أنت متأكد من حذف هذه المهمة؟')) {
                    tasks.splice(index, 1);
                    saveTasks();
                    renderTasks();
                    updateStats();
                }
            }
            
            // Clear all completed tasks
            function clearCompletedTasks() {
                const completedCount = tasks.filter(task => task.completed).length;
                
                if (completedCount === 0) {
                    alert('لا توجد مهام مكتملة لحذفها!');
                    return;
                }
                
                if (confirm(`هل أنت متأكد من حذف جميع المهام المكتملة (${completedCount} مهمة)?`)) {
                    tasks = tasks.filter(task => !task.completed);
                    saveTasks();
                    renderTasks();
                    updateStats();
                }
            }
            
            // Copy share URL to clipboard
            function copyShareUrl() {
                shareUrl.select();
                shareUrl.setSelectionRange(0, 99999); // For mobile devices
                
                navigator.clipboard.writeText(shareUrl.value)
                    .then(() => {
                        const originalText = copyUrlBtn.innerHTML;
                        copyUrlBtn.innerHTML = '<i class="fas fa-check"></i> تم النسخ!';
                        copyUrlBtn.classList.add('success');
                        
                        setTimeout(() => {
                            copyUrlBtn.innerHTML = originalText;
                            copyUrlBtn.classList.remove('success');
                        }, 2000);
                    })
                    .catch(err => {
                        console.error('Failed to copy: ', err);
                        alert('فشل نسخ الرابط. يرجى المحاولة مرة أخرى.');
                    });
            }
            
            // Event listeners
            addTaskBtn.addEventListener('click', addTask);
            
            taskText.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    addTask();
                }
            });
            
            clearCompletedBtn.addEventListener('click', clearCompletedTasks);
            copyUrlBtn.addEventListener('click', copyShareUrl);
            
            // Initialize the app
            init();
        });
    </script>
</body>
</html>
